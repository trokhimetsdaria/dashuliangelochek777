// script.js

document.addEventListener('DOMContentLoaded', function() {
  // 1. Анимация частиц в герое
  createParticles();
  
  // 2. Интерактивный курсор
  initCustomCursor();
  
  // 3. Анимация текста с эффектом печати
  initTypewriterEffect();
  
  // 4. 3D трансформации карточек
  init3DCardEffects();
  
  // 5. Параллакс слоев
  initParallax();
  
  // 6. Анимация меню с морфингом
  initMenuAnimation();
  
  // 7. Интерактивный скролл
  initSmoothScrolling();
  
  // 8. Анимация появления элементов
  initScrollAnimations();
  
  // 9. Эффект магнитных кнопок
  initMagneticButtons();
  
  // 10. Интерактивный фон
  initInteractiveBackground();
});

// Система частиц
function createParticles() {
  const hero = document.querySelector('.hero');
  const particlesContainer = document.createElement('div');
  particlesContainer.className = 'particles-container';
  particlesContainer.style.cssText = `
    position: absolute;
    top: 0;
    left: 0;
    width: 100%;
    height: 100%;
    pointer-events: none;
    overflow: hidden;
    border-radius: 10px;
  `;
  
  hero.style.position = 'relative';
  hero.appendChild(particlesContainer);
  
  for (let i = 0; i < 20; i++) {
    createParticle(particlesContainer);
  }
}

function createParticle(container) {
  const particle = document.createElement('div');
  particle.style.cssText = `
    position: absolute;
    width: 2px;
    height: 2px;
    background: rgba(255,255,255,0.8);
    border-radius: 50%;
    pointer-events: none;
  `;
  
  const startX = Math.random() * 100;
  const startY = Math.random() * 100;
  const duration = 3 + Math.random() * 4;
  
  particle.style.left = startX + '%';
  particle.style.top = startY + '%';
  
  container.appendChild(particle);
  
  // Анимация частицы
  particle.animate([
    { 
      transform: 'translate(0, 0) scale(1)',
      opacity: 0 
    },
    { 
      transform: `translate(${Math.random() * 100 - 50}px, ${Math.random() * 100 - 50}px) scale(${0.5 + Math.random()})`,
      opacity: 0.8 
    },
    { 
      transform: `translate(${Math.random() * 200 - 100}px, ${Math.random() * 200 - 100}px) scale(0)`,
      opacity: 0 
    }
  ], {
    duration: duration * 1000,
    iterations: Infinity,
    easing: 'cubic-bezier(0.4, 0, 0.2, 1)'
  });
  
  setTimeout(() => {
    if (particle.parentNode) {
      particle.parentNode.removeChild(particle);
      createParticle(container);
    }
  }, duration * 1000);
}

// Кастомный курсор
function initCustomCursor() {
  const cursor = document.createElement('div');
  cursor.className = 'custom-cursor';
  cursor.style.cssText = `
    position: fixed;
    width: 20px;
    height: 20px;
    border: 2px solid rgba(255,255,255,0.8);
    border-radius: 50%;
    pointer-events: none;
    z-index: 9999;
    mix-blend-mode: difference;
    transition: transform 0.1s ease;
  `;
  
  const cursorFollower = document.createElement('div');
  cursorFollower.className = 'cursor-follower';
  cursorFollower.style.cssText = `
    position: fixed;
    width: 8px;
    height: 8px;
    background: rgba(255,255,255,0.5);
    border-radius: 50%;
    pointer-events: none;
    z-index: 9998;
    mix-blend-mode: difference;
    transition: transform 0.2s ease;
  `;
  
  document.body.appendChild(cursor);
  document.body.appendChild(cursorFollower);
  
  let mouseX = 0, mouseY = 0;
  let followerX = 0, followerY = 0;
  
  document.addEventListener('mousemove', (e) => {
    mouseX = e.clientX;
    mouseY = e.clientY;
    cursor.style.left = (mouseX - 10) + 'px';
    cursor.style.top = (mouseY - 10) + 'px';
  });
  
  function animateCursor() {
    followerX += (mouseX - followerX - 4) * 0.1;
    followerY += (mouseY - followerY - 4) * 0.1;
    
    cursorFollower.style.left = followerX + 'px';
    cursorFollower.style.top = followerY + 'px';
    
    requestAnimationFrame(animateCursor);
  }
  animateCursor();
  
  // Эффекты при наведении
  const interactiveElements = document.querySelectorAll('a, button, .client-card, .service-card, .project-item');
  
  interactiveElements.forEach(el => {
    el.addEventListener('mouseenter', () => {
      cursor.style.transform = 'scale(1.5)';
      cursor.style.borderColor = 'rgba(255,255,255,1)';
      cursorFollower.style.transform = 'scale(1.5)';
    });
    
    el.addEventListener('mouseleave', () => {
      cursor.style.transform = 'scale(1)';
      cursor.style.borderColor = 'rgba(255,255,255,0.8)';
      cursorFollower.style.transform = 'scale(1)';
    });
  });
}

// Эффект печатающей машинки
function initTypewriterEffect() {
  const heroTitle = document.querySelector('.hero h1');
  const originalText = heroTitle.textContent;
  heroTitle.textContent = '';
  
  let i = 0;
  function typeWriter() {
    if (i < originalText.length) {
      heroTitle.textContent += originalText.charAt(i);
      i++;
      setTimeout(typeWriter, 150);
    }
  }
  
  // Запускаем после небольшой задержки
  setTimeout(typeWriter, 500);
}

// 3D эффекты для карточек
function init3DCardEffects() {
  const cards = document.querySelectorAll('.service-card, .client-card');
  
  cards.forEach(card => {
    card.style.transition = 'transform 0.3s ease, box-shadow 0.3s ease';
    
    card.addEventListener('mousemove', (e) => {
      const rect = card.getBoundingClientRect();
      const x = e.clientX - rect.left;
      const y = e.clientY - rect.top;
      
      const centerX = rect.width / 2;
      const centerY = rect.height / 2;
      
      const rotateY = (x - centerX) / 25;
      const rotateX = (centerY - y) / 25;
      
      card.style.transform = `perspective(1000px) rotateX(${rotateX}deg) rotateY(${rotateY}deg) scale3d(1.05, 1.05, 1.05)`;
      card.style.boxShadow = `
        ${-rotateY * 2}px ${rotateX * 2}px 20px rgba(0,0,0,0.3),
        inset 0 0 0 1px rgba(255,255,255,0.1)
      `;
    });
    
    card.addEventListener('mouseleave', () => {
      card.style.transform = 'perspective(1000px) rotateX(0) rotateY(0) scale3d(1, 1, 1)';
      card.style.boxShadow = '0 2px 10px rgba(0,0,0,0.1)';
    });
  });
}

// Параллакс эффект
function initParallax() {
  const hero = document.querySelector('.hero');
  
  window.addEventListener('scroll', () => {
    const scrolled = window.pageYOffset;
    const rate = scrolled * -0.5;
    hero.style.transform = `translateY(${rate}px)`;
  });
}

// Анимированное меню
function initMenuAnimation() {
  const menuBtn = document.querySelector('.menu-btn');
  const nav = document.querySelector('.nav');
  let menuOpen = false;
  
  menuBtn.addEventListener('click', function() {
    if (!menuOpen) {
      // Показываем меню с анимацией
      nav.style.display = 'flex';
      nav.style.flexDirection = 'column';
      nav.style.position = 'absolute';
      nav.style.top = '100%';
      nav.style.left = '0';
      nav.style.right = '0';
      nav.style.background = 'rgba(20, 20, 20, 0.95)';
      nav.style.backdropFilter = 'blur(10px)';
      nav.style.padding = '30px 20px';
      nav.style.border = '1px solid rgba(255,255,255,0.1)';
      nav.style.borderTop: 'none';
      nav.style.gap = '20px';
      
      // Анимация появления ссылок
      const navLinks = nav.querySelectorAll('a');
      navLinks.forEach((link, index) => {
        link.style.opacity = '0';
        link.style.transform = 'translateY(-20px)';
        link.style.transition = `all 0.3s ease ${index * 0.1}s`;
        
        setTimeout(() => {
          link.style.opacity = '1';
          link.style.transform = 'translateY(0)';
        }, 50);
      });
      
      menuBtn.innerHTML = '✕';
      menuBtn.style.transform = 'rotate(90deg)';
      menuOpen = true;
    } else {
      // Скрываем меню
      const navLinks = nav.querySelectorAll('a');
      navLinks.forEach((link, index) => {
        link.style.opacity = '0';
        link.style.transform = 'translateY(-20px)';
      });
      
      setTimeout(() => {
        nav.style.display = 'none';
        menuBtn.innerHTML = '☰';
        menuBtn.style.transform = 'rotate(0deg)';
        menuOpen = false;
      }, 300);
    }
  });
}

// Плавный скролл с инерцией
function initSmoothScrolling() {
  let currentScroll = 0;
  let targetScroll = 0;
  let ease = 0.05;
  
  function smoothScroll() {
    currentScroll += (targetScroll - currentScroll) * ease;
    window.scrollTo(0, currentScroll);
    requestAnimationFrame(smoothScroll);
  }
  
  window.addEventListener('scroll', () => {
    targetScroll = window.pageYOffset;
  });
  
  smoothScroll();
  
  // Плавные ссылки
  document.querySelectorAll('nav a').forEach(link => {
    link.addEventListener('click', function(e) {
      e.preventDefault();
      const targetId = this.getAttribute('href');
      const targetSection = document.querySelector(targetId);
      
      if (targetSection) {
        const targetPosition = targetSection.offsetTop;
        targetScroll = targetPosition;
      }
    });
  });
}

// Анимация появления при скролле
function initScrollAnimations() {
  const observer = new IntersectionObserver((entries) => {
    entries.forEach(entry => {
      if (entry.isIntersecting) {
        entry.target.classList.add('animate-in');
      }
    });
  }, {
    threshold: 0.1,
    rootMargin: '0px 0px -50px 0px'
  });
  
  document.querySelectorAll('.client-card, .service-card, .project-item, .contact-content').forEach(el => {
    el.classList.add('scroll-animate');
    observer.observe(el);
  });
}

// Магнитные кнопки
function initMagneticButtons() {
  const buttons = document.querySelectorAll('button, .service-card, .client-card');
  
  buttons.forEach(button => {
    button.addEventListener('mousemove', function(e) {
      const rect = this.getBoundingClientRect();
      const x = e.clientX - rect.left;
      const y = e.clientY - rect.top;
      
      const centerX = rect.width / 2;
      const centerY = rect.height / 2;
      
      const moveX = (x - centerX) * 0.1;
      const moveY = (y - centerY) * 0.1;
      
      this.style.transform = `translate(${moveX}px, ${moveY}px)`;
    });
    
    button.addEventListener('mouseleave', function() {
      this.style.transform = 'translate(0, 0)';
    });
  });
}

// Интерактивный фон
function initInteractiveBackground() {
  const interactiveBg = document.createElement('div');
  interactiveBg.className = 'interactive-bg';
  interactiveBg.style.cssText = `
    position: fixed;
    top: 0;
    left: 0;
    width: 100%;
    height: 100%;
    pointer-events: none;
    z-index: -1;
    background: radial-gradient(circle at 50% 50%, rgba(30, 30, 30, 0.8) 0%, rgba(10, 10, 10, 0.9) 100%);
  `;
  
  document.body.appendChild(interactiveBg);
  document.body.style.position = 'relative';
  
  document.addEventListener('mousemove', (e) => {
    const x = (e.clientX / window.innerWidth) * 100;
    const y = (e.clientY / window.innerHeight) * 100;
    
    interactiveBg.style.background = `
      radial-gradient(circle at ${x}% ${y}%, 
        rgba(40, 40, 40, 0.8) 0%, 
        rgba(10, 10, 10, 0.9) 100%)
    `;
  });
}

// Дополнительные эффекты при загрузке
window.addEventListener('load', function() {
  // Анимация загрузки
  document.body.style.opacity = '0';
  document.body.style.transition = 'opacity 0.5s ease';
  
  setTimeout(() => {
    document.body.style.opacity = '1';
  }, 100);
  
  // Случайные анимации для элементов
  setInterval(() => {
    const randomElement = document.querySelectorAll('.client-card, .service-card')[
      Math.floor(Math.random() * document.querySelectorAll('.client-card, .service-card').length)
    ];
    
    if (randomElement) {
      randomElement.style.transform = 'scale(1.02)';
      setTimeout(() => {
        randomElement.style.transform = 'scale(1)';
      }, 300);
    }
  }, 3000);
});
